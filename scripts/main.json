{
  "name": "叙事主线",
  "description": "主线情节叙事",
  "debug": true,
  "creative": false,
  "lidar": true,
  "dependencies": [
    {
      "id": "red_monster",
      "path": "/scripts/src/entities/red_monster.js"
    },
    {
      "id": "system_terminal",
      "path": "/scripts/src/layers/terminal.js"
    },
    {
      "id": "security_keypad",
      "path": "/scripts/src/layers/keypad.js"
    },
    {
      "id": "lyric_speaker",
      "path": "/scripts/src/layers/speaker.js"
    },
    {
      "id": "ending_speaker",
      "path": "/scripts/src/layers/ending.js"
    },
    {
      "id": "gate",
      "path": "/scripts/src/entities/gate.js"
    },
    {
      "id": "DeathOverlay",
      "path": "/scripts/src/layers/death.js"
    }
  ],
  "preload": [
    "/assets/models/facilities/main.glb",
    "/assets/models/facilities/numbers.glb",
    "/assets/models/facilities/1号场地的电脑.glb",
    "/assets/models/facilities/1号闸（上）.glb",
    "/assets/models/facilities/1号闸（下）.glb",
    "/assets/models/facilities/2号场地的电脑.glb",
    "/assets/models/facilities/2号闸（上）.glb",
    "/assets/models/facilities/2号闸（下）.glb",
    "/assets/models/facilities/3号场地的电脑.glb",
    "/assets/models/facilities/3号闸（上）.glb",
    "/assets/models/facilities/3号闸（下）.glb",
    "/assets/models/facilities/4号场地（渲染）.glb",
    "/assets/models/facilities/箭头.glb",
    "/assets/models/facilities/第三幕的桌子.glb",
    "/assets/models/enemies/red_monster.glb"
  ],
  "entities": [
    {
      "name": "主人公",
      "id": "self",
      "properties": {
        "coordinates": [0, 0, 0],
        "rotation": [0, 0, 0]
      }
    },
    {
      "name": "主设施",
      "id": "main_facility",
      "path": "/assets/models/facilities/main.glb",
      "properties": {
        "coordinates": [0, -2, 0],
        "lidar_color": "#007015",
        "intensity_drop": 1,
        "live_long": true,
        "rotation": [0, 0, 0]
      }
    },
    {
      "name": "密码箱",
      "id": "password_box",
      "path": "/assets/models/facilities/1号场地的电脑.glb",
      "properties": {
        "coordinates": [0, -2, 0],
        "lidar_color": "#ffeb95",
        "intensity_drop": 1,
        "rotation": [0, 0, 0],
        "access_callback": [
          "core.scene.player.teleport([0.5,2.1,137])",
          "core.script.reborn.coordinates['origin'].position=[0.5,2.1,137]",
          "core.script.reborn.coordinates['origin'].rotation=[0, -6.41, 0]"
        ]
      },
      "interact_callback": [
        "keypad.activate()",
        "console.log(global.keypad_usingTime)",
        "(!global.keypad_usingTime && speaker.speak('keypad_first'))",
        "(global.keypad_usingTime && speaker.speak('keypad_then'))",
        "global.keypad_usingTime=1"
      ]
    },
    {
      "name": "第一幕数字",
      "id": "password_number",
      "path": "/assets/models/facilities/numbers.glb",
      "properties": {
        "coordinates": [0, -2, 0],
        "lidar_color": "#ff9b2e",
        "intensity_drop": 2,
        "rotation": [0, 0, 0]
      }
    },
    {
      "name": "1号闸（上）",
      "id": "gate_1_up",
      "path": "/assets/models/facilities/1号闸（上）.glb",
      "properties": {
        "activated": false,
        "coordinates": [0, -2, 0],
        "lidar_color": "#ffeb95",
        "intensity_drop": 7,
        "rotation": [0, 0, 0]
      },
      "interact_callback": ["gate_1.toggle()"]
    },
    {
      "name": "1号闸（下）",
      "id": "gate_1_down",
      "path": "/assets/models/facilities/1号闸（下）.glb",
      "properties": {
        "activated": false,
        "coordinates": [0, -2, 0],
        "lidar_color": "#ffeb95",
        "intensity_drop": 1,
        "rotation": [0, 0, 0]
      },
      "interact_callback": ["gate_1.toggle()"]
    },
    {
      "name": "2号场地的电脑",
      "id": "computer_2",
      "path": "/assets/models/facilities/2号场地的电脑.glb",
      "properties": {
        "coordinates": [0, -2, 0],
        "lidar_color": "#ffeb95",
        "intensity_drop": 8,
        "rotation": [0, 0, 0],
        "data": {
          "enabled": false,
          "commands": [
            {
              "command": "hostname",
              "output": "TERMINAL 2",
              "callback": []
            },
            {
              "command": "whoami",
              "output": "user: BIT_LIUNX"
            },
            {
              "command": "date",
              "output": "2077-07-21 14:22:08"
            },
            {
              "command": "ls",
              "output": "gal"
            },
            {
              "command": "cat gal",
              "output": "0x0D000721",
              "callback": [
                "window.achievementSystem.trigger('0d000721')",
                "speaker.speak('narration_ciallo')"
              ]
            },
            {
              "command": "cat",
              "output": "\n"
            },
            {
              "command": "echo",
              "output": "$args"
            },
            {
              "command": "clear",
              "output": "",
              "description": "清屏",
              "callback": ["ter2.outputElement.innerHTML = '';"]
            },
            {
              "command": "exit",
              "output": "关闭终端",
              "description": "关闭终端",
              "callback": ["ter2.deactivate()"]
            },
            {
              "command": "help",
              "output": "可用命令：hostname, whoami, date, ls, cat, echo, clear, exit, deny-protocol, apt, accept",
              "description": "显示帮助信息"
            },
            {
              "command": "apt",
              "output": "apt 2.4.11 (amd64)<br/>Usage: apt [options] command<br/><br/>apt is a commandline package manager and provides commands for<br/>searching and managing as well as querying information about packages.<br/>It provides the same functionality as the specialized APT tools,<br/>like apt-get and apt-cache, but enables options more suitable for<br/>interactive use by default.<br/><br/>Most used commands:<br/>  list - list packages based on package names<br/>  search - search in package descriptions<br/>  show - show package details<br/>  install - install packages<br/>  reinstall - reinstall packages<br/>  remove - remove packages<br/>  autoremove - Remove automatically all unused packages<br/>  update - update list of available packages<br/>  upgrade - upgrade the system by installing/upgrading packages<br/>  full-upgrade - upgrade the system by removing/installing/upgrading packages<br/>  edit-sources - edit the source information file<br/>  satisfy - satisfy dependency strings<br/><br/>See apt(8) for more information about the available commands.<br/>Configuration options and syntax is detailed in apt.conf(5).<br/>Information about how to configure sources can be found in sources.list(5).<br/>Package and version choices can be expressed via apt_preferences(5).<br/>Security details are available in apt-secure(8).<br/>                                        This APT has Super Cow Powers."
            },
            {
              "command": "accept",
              "output": "已接受当前协议.",
              "description": "接受当前协议",
              "callback": [
                "speaker.speak('narration_accept')",
                "ending.activate(['这是第一个结局','这里后面会被更改掉','感谢游玩'])",
                "window.achievementSystem.trigger('ending_1')"
              ]
            },
            {
              "command": "deny-protocol",
              "output": "已禁用当前协议.",
              "description": "禁用当前协议",
              "callback": [
                "speaker.speak('refuse_protocol',()=>{speaker.speak('vanish_entirely',()=>{ter2.deactivate();})})",
                "core.script.reborn.coordinates['origin'].position=[226, 4.2, 108.34]",
                "ter2.runDenyScript()"
              ]
            }
          ],
          "monitors": [
            {
              "command": "den",
              "type": "type",
              "callback": ["speaker.speak('narration_deny')"]
            },
            {
              "command": "den",
              "type": "del",
              "callback": ["speaker.speak('narration_deny_del')"]
            }
          ],
          "denyScript": "[[type:25]][[color:red]]DENY PROTOCOL INITIALIZING...\n[[delay:700]]auth: requesting token...\r[[type:18]]auth: requesting token... ok\n[[delay:550]][[color:yellow]]spawning entity: red_monster[[/color]]\n[[delay:650]][[bar:5]][[delay:200]][[bar:15]][[delay:200]][[bar:30]][[delay:200]][[bar:45]][[delay:250]][[bar:60]][[delay:250]][[bar:75]][[delay:400]][[bar:90]][[delay:600]][[bar:100]]\n[[color:green]]compile success. linking runtime...[[/color]]\n[[delay:800]]chase(player) => active\n[[delay:900]]monitor(player)\rmonitor(player) ... ok\n[[delay:700]][[color:magenta]]teleport sequence scheduled[[/color]]\n[[delay:600]]teleport in 3...\r[[delay:1000]]teleport in 2...\r[[delay:1000]]teleport in 1...\r[[delay:900]]teleporting...\n[[delay:800]][[cb:core.scene.player.teleport([226,4.2,108.34])]][[color:cyan]]completed.\n[[/color]][[/color]][[type:0]]"
        }
      },
      "interact_callback": [
        "core.getEntity('computer_2').properties.data.enabled = core.getEntity('gate_1_down').properties.activated && core.getEntity('gate_2_down').properties.activated&& core.getEntity('gate_3_down').properties.activated",
        "ter2.activate()",
        "!core.getEntity('computer_2').properties.data.enabled && speaker.speak('narration_start',()=>{!core.getEntity('computer_2').properties.data.enabled && speaker.speak('narration_task_1')})",
        "core.getEntity('computer_2').properties.data.enabled && speaker.speak('well_done',()=>{core.getEntity('computer_2').properties.data.enabled && speaker.speak('curious_mechanism')})"
      ]
    },
    {
      "name": "2号闸（上）",
      "id": "gate_2_up",
      "path": "/assets/models/facilities/2号闸（上）.glb",
      "properties": {
        "activated": false,
        "coordinates": [0, -2, 0],
        "lidar_color": "#ffeb95",
        "intensity_drop": 7,
        "rotation": [0, 0, 0]
      },
      "interact_callback": ["gate_2.toggle()"]
    },
    {
      "name": "2号闸（下）",
      "id": "gate_2_down",
      "path": "/assets/models/facilities/2号闸（下）.glb",
      "properties": {
        "activated": false,
        "coordinates": [0, -2, 0],
        "lidar_color": "#ffeb95",
        "intensity_drop": 1,
        "rotation": [0, 0, 0]
      },
      "interact_callback": ["gate_2.toggle()"]
    },
    {
      "name": "3号场地的电脑",
      "id": "computer_3",
      "path": "/assets/models/facilities/3号场地的电脑.glb",
      "properties": {
        "coordinates": [0, 0, 0],
        "lidar_color": "#ffeb95",
        "intensity_drop": 1,
        "rotation": [0, 0, 0]
      },
      "interact_callback": []
    },
    {
      "name": "3号闸（上）",
      "id": "gate_3_up",
      "path": "/assets/models/facilities/3号闸（上）.glb",
      "properties": {
        "activated": false,
        "coordinates": [0, -2, 0],
        "lidar_color": "#ffeb95",
        "intensity_drop": 7,
        "rotation": [0, 0, 0]
      },
      "interact_callback": ["gate_3.toggle()"]
    },
    {
      "name": "3号闸（下）",
      "id": "gate_3_down",
      "path": "/assets/models/facilities/3号闸（下）.glb",
      "properties": {
        "activated": false,
        "coordinates": [0, -2, 0],
        "lidar_color": "#ffeb95",
        "intensity_drop": 1,
        "rotation": [0, 0, 0]
      },
      "interact_callback": ["gate_3.toggle()"]
    },
    {
      "name": "第三幕的桌子",
      "id": "table_3",
      "path": "/assets/models/facilities/第三幕的桌子.glb",
      "properties": {
        "coordinates": [0, -2, 0],
        "lidar_color": "#fd773a",
        "intensity_drop": 1,
        "rotation": [0, 0, 0]
      },
      "interact_callback": []
    },
    {
      "name": "4号场地（渲染）",
      "id": "field_4_render",
      "path": "/assets/models/facilities/4号场地（渲染）.glb",
      "properties": {
        "coordinates": [0, -2, 0],
        "lidar_color": "#ff9248",
        "intensity_drop": 1,
        "rotation": [0, 0, 0]
      }
    },
    {
      "name": "箭头",
      "id": "arrow",
      "path": "/assets/models/facilities/箭头.glb",
      "properties": {
        "coordinates": [0, -2, 0],
        "lidar_color": "#ff3846",
        "intensity_drop": 1,
        "rotation": [0, 0, 0]
      }
    },
    {
      "name": "怪兽",
      "id": "monster",
      "path": "/assets/models/enemies/red_monster.glb",
      "properties": {
        "enabled": true,
        "coordinates": [343.67, 1.89, 119.89],
        "lidar_color": "#dc0202",
        "platformId": "main_facility",
        "intensity_drop": 15,
        "rotation": [0, 0, 0],
        "distance": 2
      },
      "distance_callback": ["death.activate('你被删除了')"],
      "interact_callback": ["rdm.ontouch()"]
    }
  ],
  "speeches": [
    {
      "name": "初始台词",
      "id": "initial",
      "properties": {
        "type": "info",
        "description": "刚进入游戏说的话",
        "text": "这里？是哪里？",
        "duration": 3000,
        "coordinates": [0, 0, 0],
        "activated": false
      },
      "distance_callback": [
        "speaker.speak('initial')",
        "core.script.reborn.coordinates['origin'].position=[0, 0, 0]"
      ]
    },
    {
      "name": "交互教学",
      "id": "keyhelp",
      "properties": {
        "type": "info",
        "description": "交互教学",
        "text": "按<span style='color: #ffff00; font-weight: bold;'>鼠标左键</span>发射点阵照亮前方",
        "duration": 3000,
        "coordinates": [8.18, -1.09, 0],
        "activated": false
      },
      "distance_callback": ["speaker.speak('keyhelp')"]
    },
    {
      "name": "第一次打开密码箱",
      "id": "keypad_first",
      "properties": {
        "type": "info",
        "description": "第一次打开密码箱时说的话",
        "text": "看起来我需要寻找密码。",
        "duration": 3000,
        "coordinates": [0, 0, 0],
        "activated": false
      },
      "interaction_callback": ["speaker.speak('keypad_first')"]
    },
    {
      "name": "再次打开密码箱",
      "id": "keypad_then",
      "properties": {
        "type": "info",
        "description": "之后每次打开密码箱时说的话",
        "text": "密码是多少呢？",
        "duration": 1000,
        "coordinates": [0, 0, 0]
      },
      "interaction_callback": ["speaker.speak('keypad_then')"]
    },
    {
      "name": "密码正确",
      "id": "keypad_success",
      "properties": {
        "type": "info",
        "description": "密码输入正确了，此时传送到未知位置",
        "text": "??眼前的场景似乎变化了！",
        "duration": 2000,
        "activated": false,
        "coordinates": [0.5, 2.1, 137]
      },
      "distance_callback": ["speaker.speak('keypad_success')"]
    },
    {
      "name": "旁白初始",
      "id": "narration_start",
      "properties": {
        "type": "voice",
        "description": "旁白初始音频，打招呼",
        "activated": false,
        "text": {
          "0": "中午好。​​​​​​​​​​​​​​​​",
          "1500": "我知道你看不出时间，毕竟这里连扇窗户都没有。",
          "6000": "但相信我，现在就是中午——故事需要个开头，而”午后”听起来不错。"
        },
        "audio": "/assets/sounds/narrator/narration_start.mp3"
      }
    },
    {
      "name": "旁白第一个任务",
      "id": "narration_task_1",
      "properties": {
        "type": "voice",
        "description": "旁白第一个任务音频，提示开电闸",
        "activated": false,
        "text": {
          "0": "好了，回归正题。",
          "2000": "现在，为了让故事能继续下去，一个简单而又关键的任务摆在了你的面前：",
          "9000": "这附近有三个电闸，把它们打开，史丹利。把它们全部打开。"
        },
        "audio": "/assets/sounds/narrator/narration_task_1.mp3"
      }
    },
    {
      "name": "旁白柚子厨",
      "id": "narration_ciallo",
      "properties": {
        "type": "voice",
        "description": "旁白柚子厨音频，彩蛋",
        "activated": false,
        "text": {
          "0": "又一个柚子厨，无语。"
        },
        "audio": "/assets/sounds/narrator/narration_ciallo.mp3"
      }
    },
    {
      "name": "旁白发现deny",
      "id": "narration_deny",
      "properties": {
        "type": "voice",
        "description": "旁白发现deny音频",
        "text": {
          "0": "不要这样！你认为你在做什么？",
          "3000": "我必须提醒你，这可不是个好主意。"
        },
        "audio": "/assets/sounds/narrator/narration_deny.mp3"
      }
    },
    {
      "name": "旁白删掉deny",
      "id": "narration_deny_del",
      "properties": {
        "type": "voice",
        "description": "旁白删掉deny音频",
        "text": {
          "0": "这才对嘛！是时候回到正轨上了。"
        },
        "audio": "/assets/sounds/narrator/narration_deny_del.mp3"
      }
    },
    {
      "name": "和怪物交互",
      "id": "inter_monster",
      "properties": {
        "type": "info",
        "description": "和怪物交互时说的话",
        "text": "嗷呜",
        "duration": 1000
      }
    },
    {
      "name": "干得漂亮",
      "id": "well_done",
      "properties": {
        "type": "voice",
        "description": "干得漂亮",
        "text": {
          "0": "哦？你居然真的照做了。",
          "2000": "好极了，史丹利。准备工作已经结束了。",
          "6000": "好了，去看看接下来等待你的是什么。"
        },
        "audio": "/assets/sounds/narrator/well_done.mp3"
      }
    },
    {
      "name": "好奇原理",
      "id": "curious_mechanism",
      "properties": {
        "type": "voice",
        "description": "好奇原理",
        "text": {
          "0": "你大概在想，这一切究竟有什么用？它是如何运作的？",
          "4500": "可说实话，那并不重要。",
          "8000": "重要的是，你需要把工作完成，在底下的终端上签署那份协议。输入accept，接受它。"
        },
        "audio": "/assets/sounds/narrator/curious_mechanism.mp3"
      }
    },
    {
      "name": "拒绝协议",
      "id": "refuse_protocol",
      "properties": {
        "type": "voice",
        "description": "拒绝协议",
        "text": {
          "0": "哦？你居然拒绝了这份协议。真是个有趣的选择。",
          "3500": "这个世界已经如此完美，而你却执意要把它弄乱。",
          "7000": "我实在不明白，为什么？"
        },
        "audio": "/assets/sounds/narrator/refuse_protocol.mp3"
      }
    },
    {
      "name": "彻底消失",
      "id": "vanish_entirely",
      "properties": {
        "type": "voice",
        "description": "彻底消失",
        "text": {
          "0": "但别急着担心，史丹利。",
          "2000": "很快，你就会彻底消失。"
        },
        "audio": "/assets/sounds/narrator/vanish_entirely.mp3"
      }
    }
  ],
  "global": {
    "interact_distance": 5,
    "keypad_usingTime": 0,
    "level_bgm": "/assets/sounds/ingamesounds/level_bgm.mp3",
    "subtitles": ["在这个被遗忘的终端站...", "感谢你的游玩。"],
    "credits": {
      "title": "TERMINUS",
      "subtitle": "开发团队",
      "members": [
        {
          "role": "游戏总监",
          "name": "不愿透露名字"
        },
        {
          "role": "程序开发",
          "name": "不愿透露名字"
        },
        {
          "role": "程序开发",
          "name": "不愿透露名字"
        },
        {
          "role": "美术音乐",
          "name": "不愿透露名字"
        },
        {
          "role": "关卡设计",
          "name": "不愿透露名字"
        },
        {
          "role": "场景建模",
          "name": "不愿透露名字"
        },
        {
          "role": "神秘嘉宾A",
          "name": "是谁呀好难猜呢"
        },
        {
          "role": "神秘嘉宾B",
          "name": "是谁呀好难猜呢"
        }
      ]
    }
  },
  "reborn": {
    "enabled": true,
    "reborn_id": "origin",
    "coordinates": {
      "origin": {
        "position": [0, 0, 0],
        "rotation": [0, 0, 0]
      }
    }
  },
  "shortcut": {
    "KeyL": "core.scene.toggleLidar()",
    "KeyT": "ter.toggle()",
    "KeyK": "keypad.toggle()",
    "KeyD": "core.devtool.toggle()",
    "KeyC": "core.script.creative ^= 1",
    "KeyB": "core.scene.updateDebug();",
    "KeyV": "core.scene.clearDebug();",
    "KeyP": "core.scene.RayCaster.clearAllPoint();"
  },
  "scripts": [
    "rdm = new red_monster('monster')",
    "window.global=core.script.global",
    "ending=new ending_speaker()",
    "speaker=new lyric_speaker()",
    "core.scene.load('main_facility')",
    "core.scene.load('monster')",
    "core.layers.push(core.scene)",
    "core.scene.spawn()",
    "core.scene.load('password_number')",
    "core.scene.load('password_box')",
    "core.scene.load('table_3')",
    "gate_1 = new gate('gate_1')",
    "gate_2 = new gate('gate_2')",
    "gate_3 = new gate('gate_3')",
    "gate_1.activate()",
    "gate_2.activate()",
    "gate_3.activate()",
    "keypad=new security_keypad('password_box')",
    "keypad.setPassword('635')",
    "ter2=new system_terminal('computer_2')",
    "core.scene.load('computer_2')",
    "ter2.entity.properties.data.enabled=true",
    "ter2.activate()",
    "death = new DeathOverlay();",
    "core.getEntity('monster').properties.enabled && rdm.activate()",
    "!core.getEntity('monster').properties.enabled && rdm.deactivate()"
  ]
}
